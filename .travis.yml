# more info:
# https://config.travis-ci.com/
dist: bionic

language: go

go:
  - 1.14.x

git:
  depth: 1

jobs:
  include:
    - stage: test
      script: go test -v ./cmd
    - # test
      services:
        - docker
        - redis
      install:
        # setup kafka
        - ./travis/setup-kafka.sh
        # wait for kafka start
        - ./travis/await-kafka.sh
        # setup aerospike
        - ./travis/aerospike-setup.sh
        # start aerospike
        - sudo systemctl start aerospike
      script: go test -v ./internal
    - stage: simple
      script: ./simulate-sleep.sh

notifications:
  email: false
